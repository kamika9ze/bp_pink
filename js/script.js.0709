var bp = {};

(function($) {

    'use strict';

    var BlackPearl = window.BlackPearl || {};

    BlackPearl = (function() {
        var BlackPearl = function() {
            this.endpoints = ['compare', 'favorite', 'cart'];
            this.route = '/api/cookie/';

            this.init();
        }

        return BlackPearl;
    }());

    BlackPearl.prototype.init = function() {
        var _this = this;

        this.update();
 
        $(document).off('click.shop:controls'); // Protect from loops
        $(document).on('click.shop:controls', '[data-toggle="shop"]', function(event) {
            event.preventDefault();
            _this.toggle(this);
        });

        $(document).off('click.shop:remove'); // Protect from loops
        $(document).on('click.shop:remove', '[data-toggle="shop-remove"]', function(event) {
            event.preventDefault();
            _this.removeProduct(this);
			_this.refreshIndicators();
        });

        // Run interval to refresh the indicators
        function refresh() {
            window.setTimeout(refresh, 250);
            _this.refreshIndicators();
            _this.refreshIcons();
        }
        refresh();
    };

    BlackPearl.prototype.update = function() {
        var _this = this;
		
        $.each(this.endpoints, function(index, endpoint) {
            _this.get(endpoint, function(stringValues) {
                var iconLink = $('li.' + endpoint + '-status a');
				if(stringValues.length > 0) {
                    var arrayValues = stringValues.split(',');
                    if(arrayValues.length > 0) {
                        _this[endpoint] = arrayValues;
					  if (iconLink.length && iconLink.attr('data-toggle') == 'modal') {
						iconLink.removeAttr( "data-toggle" );
						iconLink.removeAttr( "data-target" );
					  }	
                    }
                } else {
                    _this[endpoint] = null;
					if (iconLink.length && !iconLink.attr('data-toggle')) {
					  iconLink.attr( "data-toggle", "modal");  
					  var clearEndpoint = endpoint;
					  if (endpoint == 'favorite') clearEndpoint = 'favourite'; 
					  iconLink.attr( "data-target", "#modal-" + clearEndpoint );  
					}
                }
            });
        });
    };

    BlackPearl.prototype.get = function(endpoint, callback) {
        var _this = this;
        var callback = callback || function() {};

        var url = this.route + endpoint;
        $.getJSON(url, function(data) {
            callback(data[endpoint+'_products']);
        });
    };

    BlackPearl.prototype.set = function(elem) {
        var _this = this,
            endpoint = $(elem).attr('data-endpoint'),
            id = $(elem).attr('data-product');

        if(id) {
            var url = this.route + endpoint + '/' + id;
            $.getJSON(url, function() {
                _this.update();
            });
        }
    };

    BlackPearl.prototype.delete = function(elem) {
        var _this = this,
            endpoint = $(elem).attr('data-endpoint'),
            id = $(elem).attr('data-product');

        if(id) {
            var url = this.route + endpoint + '/' + id + '/delete';
            $.getJSON(url, function() {
                _this.update();
            });
        }
    };

    BlackPearl.prototype.toggle = function(elem) {
        if(!elem) {return;}
        return !$(elem).hasClass('active') ? this.set(elem) : this.delete(elem);
    };

    BlackPearl.prototype.removeProduct = function(elem) {
        var $teasers = $(elem).parents('.teasers-wrapper');
        var href = window.location.href;
        this.delete(elem);
        $(elem).parents('.product-item').hide(200, function() {
            $(elem).parents('.product-item').remove();

            if($teasers.find('.product-item').length === 0) {
                //window.location.href = href;
            }
        });
    };

    BlackPearl.prototype.refreshIndicators = function() {
        var _this = this;

        $.each(this.endpoints, function(index, endpoint) {
            var values = _this[endpoint] || null;

            if(values && values.length > 0) {
                $('.'+endpoint+'-status .indicator').text(values.length);
                $('.'+endpoint+'-status .indicator').show();
            } else {
                $('.'+endpoint+'-status .indicator').hide(200);
            }
        });
    };

    BlackPearl.prototype.refreshIcons = function() {
        var _this = this;

        $('[data-toggle="shop"]').each(function() {
            var endpoint = $(this).attr('data-endpoint');
            if(_this[endpoint] instanceof Array && _this[endpoint].indexOf($(this).attr('data-product')) > -1) {
                $(this).addClass('active');
            } else {
                $(this).removeClass('active');
            }
        });
    };

    // Make BlackPearl available in global scope
    bp = new BlackPearl();

}(jQuery));
(function($) {

    Drupal.behaviors.slickCarousels = {
        attach: function() {
            if($('#bp-slideshow').length > 0 && !$('#bp-slideshow').hasClass('slick-initialized')) {
                $('#bp-slideshow').slick({dots: true, arrows: true, autoplay: true, autoplaySpeed: 5000, infinite: false});
            }
            if($('#bp-slideshow-new').length > 0 && !$('#bp-slideshow-new').hasClass('slick-initialized')) {
                $('#bp-slideshow-new').slick({
                  dots: true, arrows: false, infinite: false, 
                  responsive:[
                    {
                        breakpoint: 767,
                        settings: {
                            arrows: true
                        }
                    }
                  ]
                });
            }
            if($('#bp-slideshow-video').length > 0 && !$('#bp-slideshow-video').hasClass('slick-initialized')) {
                $('#bp-slideshow-video').slick({dots: true, arrows: false, infinite: false});
            }
            if($('#bp-carousel-megamenu-bio').length > 0 && !$('#bp-carousel-megamenu-bio').hasClass('slick-initialized')) {
                $('#bp-carousel-megamenu-bio').slick({dots: true, arrows: false, slidesToShow: 7, slidesToScroll: 7, infinite: false});
            }
            Drupal.behaviors.slickCarousels.carousel();
            Drupal.behaviors.slickCarousels.carouselThree();
            Drupal.behaviors.slickCarousels.compareMobile();
            Drupal.behaviors.slickCarousels.favorite();
            Drupal.behaviors.slickCarousels.insta();
            Drupal.behaviors.slickCarousels.questions();
            Drupal.behaviors.slickCarousels.articleRecommend();
            Drupal.behaviors.slickCarousels.lineProducts();
            //Drupal.behaviors.slickCarousels.productsView();
            //Drupal.behaviors.slickCarousels.answers();
        },
        carousel: function() {
            if($('#bp-carousel').length > 0 && !$('#bp-carousel').hasClass('slick-initialized')) {
                $('#bp-carousel').slick({dots: true, arrows: false, slidesToShow: 4, slidesToScroll: 4, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 767,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            dots: true,
                            arrows: true
                        }
                    },
                    {
                        breakpoint: 568,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            dots: true,
                            arrows: true
                        }
                    }
                ]});
            }
        },
        carouselThree: function() {
            if($('#bp-carousel-three').length > 0 && !$('#bp-carousel-three').hasClass('slick-initialized')) {
                $('#bp-carousel-three').slick({dots: true, arrows: false, slidesToShow: 3, slidesToScroll: 1, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 568,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            dots: true,
                            arrows: false
                        }
                    }
                ]});
            }
        },
        compare: function() {
            if($('#bp-carousel-compare-content').length > 0 && !$('#bp-carousel-compare-content').hasClass('slick-initialized')) {
                $('#bp-carousel-compare-content').slick({dots: false, arrows: true, slidesToShow: 4, slidesToScroll: 4, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: true,
                            arrows: false
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2,
                            dots: true,
                            arrows: true
                        }
                    }
                ]});
            }
        },
        compareMobile: function() {
            if($('#bp-carousel-compare-mobile').length > 0 && !$('#bp-carousel-compare-mobile').hasClass('slick-initialized')) {
                $('#bp-carousel-compare-mobile').slick({slidesToShow: 3, slidesToScroll: 1, infinite: false, responsive:[
                    {
                        breakpoint: 568,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2,
                            dots: true
                        }
                    }
                ]});
            }
        },
        favorite: function() {
            if($(window).width() < 767){
              if($('#bp-carousel-favorite').length > 0 && !$('#bp-carousel-favorite').hasClass('slick-initialized')) {
                  $('#bp-carousel-favorite').slick({dots: true, arrows: true, adaptiveHeight: true, slidesToShow: 1, slidesToScroll: 1, infinite: false, responsive:[
                      {
                          breakpoint: 767,
                          settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                          }
                      }
                  ]});
              }              
            }
            else {
              if($('#bp-carousel-favorite').hasClass('slick-initialized')){
                $('#bp-carousel-favorite').slick('unslick');
              }
            }            
        },
        insta: function() {//
            if($('#insta-carousel').length > 0 && !$('#insta-carousel').hasClass('slick-initialized')) {
                $('#insta-carousel').slick({dots: false, arrows: true, slidesToShow: 4, slidesToScroll: 4, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            //centerMode: true,
                            //centerPadding: '80px',
                            dots: false
                        }
                    },
                    {
                        breakpoint: 568,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            //centerMode: true,
                            //centerPadding: '60px',
                            dots: false
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            //centerMode: true,
                            //centerPadding: '40px',
                            dots: false
                        }
                    },
                    {
                        breakpoint: 375,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            //centerMode: true,
                            //centerPadding: '20px',
                            dots: false
                        }
                    }
                ]});
            }
        },
        components: function() {
            if($('#bp-components-carousel').length > 0 && !$('#bp-components-carousel').hasClass('slick-initialized')) {
                $('#bp-components-carousel').slick({dots: true, arrows: false, slidesToShow: 4, slidesToScroll: 4, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            centerMode: true,
                            centerPadding: '40px',
                            dots: false
                        }
                    }
                ]});
            }
        },
        review: function() {
            if($('#bp-reviews').length > 0 && !$('#bp-reviews').hasClass('slick-initialized')) {
                $('#bp-reviews').slick({dots: true, arrows: false, slidesToShow: 3, slidesToScroll: 1, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2
                        }
                    },
                    {
                        breakpoint: 767,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1,
                            dots: true,
                            arrows: true
                        }
                    }
                ]});
            }
        },
        questions: function() {
            if($('#bp-questions').length > 0 && !$('#bp-questions').hasClass('slick-initialized')) {
                $('#bp-questions').slick({dots: false, arrows: true, slidesToShow: 9, slidesToScroll: 1, vertical: true, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 9,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 9,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 5,
                            slidesToScroll: 5
                        }
                    }
                ]});
            }
        },
        answers: function() {
            if($('#bp-answers .block-answers--list-item').length > 3 && !$('#bp-answers').hasClass('slick-initialized')) {
                $('#bp-answers').slick({dots: false, arrows: true, slidesToShow: 4, slidesToScroll: 1, vertical: true, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 4,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 700,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                        }
                    }
                ]});
            }
        }, 
        articleRecommend: function() {
            if($('#bp-article-recommend').length > 0 && !$('#bp-article-recommend').hasClass('slick-initialized')) {
                $('#bp-article-recommend').slick({dots: false, arrows: true, slidesToShow: 3, slidesToScroll: 1, infinite: false, responsive:[
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 1
                        }
                    },
                    {
                        breakpoint: 700,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                        }
                    }
                ]});
            }
        },
        lineProducts: function() {
            if($(window).width() < 767){
              if($('#bp-line-products').length > 0 && !$('#bp-line-products').hasClass('slick-initialized')) {
                  $('#bp-line-products').slick({dots: true, arrows: true, adaptiveHeight: true, slidesToShow: 1, slidesToScroll: 1, infinite: false, responsive:[
                      {
                          breakpoint: 767,
                          settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                          }
                      }
                  ]});
              }              
            }
            else {
              if($('#bp-line-products').hasClass('slick-initialized')){
                $('#bp-line-products').slick('unslick');
              }
            }

        },  
        productsView: function() {
            if($(window).width() < 767){
              if($('#catalogue-products-view').length > 0 && !$('#catalogue-products-view').hasClass('slick-initialized')) {
                  $('#catalogue-products-view').slick({dots: true, arrows: true, adaptiveHeight: true, slidesToShow: 1, slidesToScroll: 1, infinite: false, responsive:[
                      {
                          breakpoint: 767,
                          settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                          }
                      }
                  ]});
              }  
              else {
                $('#catalogue-products-view').slick('unslick');
                $('#catalogue-products-view').slick({dots: true, arrows: true, adaptiveHeight: true, slidesToShow: 1, slidesToScroll: 1, infinite: false, responsive:[
                    {
                        breakpoint: 767,
                        settings: {
                          slidesToShow: 1,
                          slidesToScroll: 1
                        }
                    }
                ]});                
              }
            }
            else {
              if($('#catalogue-products-view').hasClass('slick-initialized')){
                $('#catalogue-products-view').slick('unslick');
              }
            }

        },    
        cartPreview: function(unslick) {
            if(!unslick) {
                if($('#bp-carousel-cart-preview').length > 0 && !$('#bp-carousel-cart-preview').hasClass('slick-initialized')) {
                    $('#bp-carousel-cart-preview').slick({slidesToShow: 1, slidesToScroll: 1, infinite: false});

                    $('#bp-carousel-cart-preview .trigger-trash').off('click');
                    $('#bp-carousel-cart-preview .trigger-trash').on('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        var count = $(this).parents('.teaser').index();

                        Drupal.behaviors.shopCart.off(this);
                        $('#bp-carousel-cart-preview').slick('slickRemove', count);
                        $('#bp-carousel-cart-preview').slick('setPosition');

                        if($('#bp-carousel-cart-preview .teaser').length === 0) {
                            $('#bp-carousel-cart-preview').html('<p class="text-big">???? ??????? ?????</p>');
                        }
                    });
                }
            } else {
                if($('#bp-carousel-cart-preview').hasClass('slick-initialized')) {
                    $('#bp-carousel-cart-preview .trigger-trash').off('click');
                    $('#bp-carousel-cart-preview').slick('unslick');
                }
            }
        },
    }
    
    $(window).resize(function(){
      Drupal.behaviors.slickCarousels.favorite();
      Drupal.behaviors.slickCarousels.lineProducts();
      Drupal.behaviors.slickCarousels.productsView();
    });

	/*Drupal.behaviors.compareSortingRow = {
        attach: function() {
            $('.bp-carousel-compare-thead-wrapper .btn-big').on('click', function(e) {
                if($(this).not('.active').hasClass('trigger-show-main-propeties')){
                  $('.compare-table .compare-cell.secondary-properties').addClass('hidden');  
                  $('.bp-carousel-compare-thead-wrapper .btn-big').removeClass('active');
                  $(this).addClass('active');
                }
                if($(this).not('.active').hasClass('trigger-show-all-propeties')){
                  $('.compare-table .compare-cell.secondary-properties').removeClass('hidden');  
                  $('.bp-carousel-compare-thead-wrapper .btn-big').removeClass('active');
                  $(this).addClass('active');
                }

                Drupal.behaviors.slickCarousels.compare();
                e.preventDefault();
            });
            //$('.bp-carousel-compare-thead-wrapper .btn-big.trigger-show-main-propeties').on('click')();
        }
    }*/

}(jQuery));
(function($) {

    Drupal.behaviors.modalOpen = {
        attach: function() {
            $('#product-modal').on('show.bs.modal', function(event) {
                var $button = $(event.relatedTarget);
                var id = $button.attr('data-product');
				if(id) {
                    $.ajax('/modal/product/'+id).done(function(data) {
                        $('#product-modal .modal-body').remove();
                        $('#product-modal .modal-controls').remove();
                        $('#product-modal .modal-content').append(data);
                        Drupal.behaviors.productGallery.attach();
                        Drupal.behaviors.ratingTrigger.attach();
                    });
                }
            });
            $('#product-selection').on('show.bs.modal', function(event) {
                var params = {"type": "html", "image_style": "teaser_small", "max": 30, "trigger": "compare"};

                $.get('/api/get/products', params, function(response) {
                    $('#catalogue-products-small-view').html(response);
                    $('#catalogue-products-small-view .product-item a').on('click', function(e) {
                        e.preventDefault();
                    });
                });
            });
        }
    }
    
    Drupal.behaviors.compareSortingRow = {
        attach: function() {
            
            $('.bp-carousel-compare-thead-wrapper .btn-big').on('click', function(e) {
                if($(this).not('.active').hasClass('trigger-show-main-propeties')){
                  $('.compare-table .compare-cell.secondary-properties').addClass('hidden');  
                  $('.bp-carousel-compare-thead-wrapper .btn-big').removeClass('active');
                  $(this).addClass('active');
                }
                if($(this).not('.active').hasClass('trigger-show-all-propeties')){
                  $('.compare-table .compare-cell.secondary-properties').removeClass('hidden');  
                  $('.bp-carousel-compare-thead-wrapper .btn-big').removeClass('active');
                  $(this).addClass('active');
                }

                Drupal.behaviors.slickCarousels.compare();
                e.preventDefault();
            });
        }
    }
    
    Drupal.behaviors.hoverTeaser = {
        attach: function() {
            $( document ).ajaxComplete(function() {
			  var listener_hover = function() {
				$(this).parents('#catalogue-products-view').addClass("hovered");
              };
              var listener_unhover = function(){
                $(this).parents('#catalogue-products-view').removeClass("hovered");
              };
              $('#catalogue-products-view .teaser-inner').off("mouseover", listener_hover);
              $('#catalogue-products-view .teaser-inner').off("mouseout", listener_unhover);
              
              $('#catalogue-products-view .teaser-inner').on("mouseover", listener_hover);
              $('#catalogue-products-view .teaser-inner').on("mouseout", listener_unhover);
            });    
        }
    }
	
    Drupal.behaviors.mainHitHoverTeaser = {
      attach: function() {
        var slick_dots_hovered = false;
        hover_listener_latest_products();
        
        $(document).ajaxComplete(function() {
          hover_listener_latest_products();
        }); 
    
        function hover_listener_latest_products() {
          /* var listener_hover = function() {
          
            $(this).addClass("hovered");
            $( "#block-bp-frontpage-latest-products ul.slick-dots" ).mouseout(function() {
              slick_dots_hovered = false;
            });
            $( "#block-bp-frontpage-latest-products ul.slick-dots" ).mouseover(function() {
              slick_dots_hovered = true;
            });
            
            if (!slick_dots_hovered) {
              $(this).addClass("hovered");	
            } else {
              $(this).removeClass("hovered");
            }
          };
          
          var listener_unhover = function(){
            $(this).removeClass("hovered");
          };
          $('#block-bp-frontpage-latest-products #slideshow-new-wrapper').off("mouseover", listener_hover);
          $('#block-bp-frontpage-latest-products #slideshow-new-wrapper').off("mouseout", listener_unhover);
          
          $('#block-bp-frontpage-latest-products #slideshow-new-wrapper').on("mouseover", listener_hover);
          $('#block-bp-frontpage-latest-products #slideshow-new-wrapper').on("mouseout", listener_unhover); */
          
          var target_fill     = $('#block-bp-frontpage-latest-products #slideshow-new-wrapper');
          var target_dots     =  $('#block-bp-frontpage-latest-products ul.slick-dots li');
          var target_arrows   =  $('#block-bp-frontpage-latest-products .slick-arrow, #block-bp-frontpage-latest-products ul.slick-dots li');
          
          $('#block-bp-frontpage-latest-products #slideshow-new-wrapper .slide').bind('mouseover', function(e){
            var target = $(e.target);
            if(!target.is(target_arrows)) {
              target_fill.addClass('hovered'); 
            }  
          }).bind('mouseout', function(e){
            target_fill.removeClass('hovered'); 
          })         
        }
        
      }
    }
    
    
    Drupal.behaviors.showMobileMenuProduct = {
      attach: function() {
        
        
      }
    }
    
    Drupal.behaviors.showMobileMenuProduct = {
      attach: function() {
        $('.horizontal-tabs-links .horizontal-tabs-data').on('click', function(e) {
          $(this).parents('.horizontal-tabs-links').toggleClass('active');
          
          e.preventDefault();
        });
        $('.horizontal-tabs-links ul.horizontal-tabs li a').on('click', function(e) {
          var text_link = $(this).text();
          $('.horizontal-tabs-links .horizontal-tabs-data .data-text').text(text_link);
          $('.horizontal-tabs-links').removeClass('active');
          
          e.preventDefault();
        });
      }
    }    
    
    Drupal.behaviors.makeFullPage = {
      attach: function() {
        $( window ).scroll(function() {
		  var breakpoints = {
			'section1' : $('#section1').height()/4 * 3,  
			'section2' : $('#section1').height() + $('#section2').height()/4 * 3,  
			'section3' : $('#section1').height() + $('#section2').height() + $('#section3').height()/4 * 3,  
			'section4' : $('#section1').height() + $('#section2').height() + $('#section3').height() + $('#section4').height()/4 * 3,  
			'section5' : $('#section1').height() + $('#section2').height() + $('#section3').height() + $('#section4').height() + $('#section5').height()/4 * 3,  
		  };
		  
		  var menu_items = {
			'section1' : 'brand',
			'section2' : 'history',
			'section3' : 'mission',
			'section4' : 'phylosophy',
			'section5' : 'news',
		  }
		  
		  var more_id = '';
		  var less_id = '';
		  for (var sec_id in breakpoints) {
			if (breakpoints[sec_id] <= window.scrollY) {
			  more_id = sec_id;
			} else if (less_id == '' && breakpoints[sec_id] > window.scrollY) {
			  less_id = sec_id;	
			}
		  }
		  
		  if (less_id && more_id) {
			removeSectionClassActive();
			$('#' + less_id).addClass('active');
			$('body').addClass('fp-viewing-' + menu_items[less_id]);
			$('#menu.menu-list li[data-menuanchor=' + menu_items[less_id] + ']').addClass('active');
		  } else if (!more_id && less_id) {
			removeSectionClassActive();
			$('#section1').addClass('active'); 
			$('body').addClass('fp-viewing-' + menu_items[less_id]);
		    $('#menu.menu-list li[data-menuanchor=' + menu_items[less_id] + ']').addClass('active');			
		  }
		});
		
		var $root = $('html, body');
		var clicked = false;
		$('#menu.menu-list li a').click(function(event) {
		  event.preventDefault();
		  var href = $.attr(this, 'href');
		 	 
		  if (!clicked) {
			clicked = true;
		    $root.animate({
			  scrollTop: $('[data-anchor="' + href.split('#')[1] + '"]').offset().top - 100
		    }, 500, function () {
		 	  clicked = false;
			  window.location.hash = href;
		    });
		  }
		});
		
		$('.inline-menu a[title="�������"]').click(function(event) {
		  $root.animate({
			scrollTop: $('[data-anchor="history"]').offset().top - 100
		  }, 500, function () {
			window.location.hash = '#history';
		  });
		});
		
		$('.inline-menu a[title="������"]').click(function(event) {
		  $root.animate({
			scrollTop: $('[data-anchor="mission"]').offset().top - 100
		  }, 500, function () {
			window.location.hash = '#mission';
		  });
		});
		
		$('.inline-menu a[title="�������"]').click(function(event) {
		  $root.animate({
			scrollTop: $('[data-anchor="news"]').offset().top - 100
		  }, 500, function () {
			window.location.hash = '#news';
		  });
		});
		
		function removeSectionClassActive() {
		  $('#section1').removeClass('active');
		  $('#section2').removeClass('active');
		  $('#section3').removeClass('active');
		  $('#section4').removeClass('active');
		  $('#section5').removeClass('active');
		  
		  $('#menu.menu-list li').removeClass('active');
		  
		  $('body').removeClass('fp-viewing-brand');
		  $('body').removeClass('fp-viewing-history');
		  $('body').removeClass('fp-viewing-mission');
		  $('body').removeClass('fp-viewing-phylosophy');
		  $('body').removeClass('fp-viewing-news');
		}
		/* //
		
		$('#fullpage').fullpage({
            anchors: ['brand', 'history', 'mission', 'phylosophy', 'news'],
            menu: '#menu',
            paddingTop: '0',
            //css3: true,
            //controlArrows: true,
            //scrollingSpeed: 1000,
			autoScrolling: false,
            //scrollOverflow: true,
            easingcss3: 'cubic-bezier(0.175, 0.885, 0.320, 1.275)',
            //fixedElements: '.header, .menu',
        });
        $('#move-section-down').click(function(e){
          e.preventDefault();
          $.fn.fullpage.moveSectionDown();
        }); 
		
		*/
      }
    }
    
   
}(jQuery));
(function($) {

    var headerActiveState;
    var hideTimeout;

    function showDropdown(e, item, overflow) {

        function getCarousel(carouselID, tid) {
            $('#megamenu-wrapper .ajax-loader').show();
            $('#bp-megamenu-carousels').css('opacity', .4);
            $.get('/api/get/products', {"field_programs": tid, "type": "html", "image_style": "teaser_small"}, function(response) {
                $('#megamenu-wrapper .ajax-loader').hide();
                $('#bp-megamenu-carousels').css('opacity', 1);
                if(response) {
                    if($(carouselID).length === 0) {
                        $('#bp-megamenu-carousels').append('<div class="carousel carousel-'+tid+'">'+response+'</div>');
                        if($(carouselID).length > 0 && !$(carouselID).hasClass('slick-initialized')) {
                            $(carouselID).slick({dots: true, arrows: false, slidesToShow: 7, slidesToScroll: 7, infinite: false});
                        }
                        displayCarousel(carouselID);
                    }
                }
            });
        }

        function displayCarousel(carouselID) {
            $('#megamenu-wrapper .carousel').hide();
            $(carouselID).show();
            $('.carousel').slick('setPosition');

            var height = $(carouselID).height() + 30;
            if($(carouselID).find('.slick-dots').length > 0) {
                height += 40;
            }
            $('#megamenu-wrapper').css('height', height);
        }

        clearTimeout(hideTimeout);

        // Reset all 'li.expanded ul' to avoid appearing several dropdowns
        $('li.expanded ul').hide().removeClass('fadein').removeClass('fadeout').parent().removeClass('active');

        $(item).addClass('active');
        $(item).find('ul').show().addClass('fadein').removeClass('fadeout');

        $('#header-additional').css('visibility', 'visible').addClass('rolldown').removeClass('rollup');

        // Detect if item is parent menu item
        if($(e.target).parent().hasClass('expanded') && $(e.target).parent().attr('data-tid') !== undefined && !$(e.target).hasClass('child-menu')) {
            $('#megamenu-wrapper').show().css('visibility', 'visible');
            var tid = $(item).find('ul li:first a').attr('data-tid');
            var carouselID = '#bp-megamenu-carousels .carousel.carousel-'+tid;
            if($(item).find('ul li.active').length === 0) {
                $(item).find('ul li').removeClass('active');
                $(item).find('ul li:first').addClass('active');
                getCarousel(carouselID, tid);
            } else {
                $(item).find('ul li').removeClass('active');
                $(item).find('ul li:first').addClass('active');
                displayCarousel(carouselID);
            }
        }
        if($(item).find('ul li:first a.trigger-megamenu-products').length > 0) {
            $('#megamenu-wrapper').show().css('visibility', 'visible');
            if($(e.target).hasClass('trigger-megamenu-products')) {
                $(item).find('ul li').removeClass('active');
                $(e.target).parent().addClass('active');
                var tid = $(e.target).attr('data-tid');
                var carouselID = '#bp-megamenu-carousels .carousel.carousel-'+tid;
                if($(carouselID).length === 0) {
                    getCarousel(carouselID, tid);
                } else {
                    displayCarousel(carouselID);
                }
            }
        } else {
            $('#megamenu-wrapper').hide();
        }
        if(overflow !== 'visible') {
            $('body').addClass('overflow-hidden');
        }

        hideCartPreview();
    }
    function hideDropdown(item) {
        headerActiveState = '';
        $('li.expanded').removeClass('active');
        $(item).find('li.expanded ul').addClass('fadeout').removeClass('fadein');

        $('#header-additional').addClass('rollup').removeClass('rolldown');

        hideTimeout = setTimeout(function() {
            $(item).find('li.expanded ul').hide();
            $('#header-additional').css('visibility', 'hidden');
            $('#megamenu-wrapper').hide();
        }, 150);
        $('body').removeClass('overflow-hidden');
    }
    function showSearch() {
        $('.bp-usermenu .trigger-search').addClass('active');
        $('.search-block-wrapper').show().removeClass('searchOut').addClass('searchIn');
        $('main').stop().animate({opacity: .25}, 300, function() {
            $('.search-block-wrapper input[type="text"]').focus();
        });
        hideDropdown($('li.expanded ul'));
    }
    function hideSearch() {
        $('.bp-usermenu .trigger-search').removeClass('active');
        $('.search-block-wrapper').removeClass('searchIn').addClass('searchOut');
        $('main').stop().animate({opacity: 1}, 300);
    }
    function showHamburger() {
        var left = $('main').width() - 8;
        $('#hamburger-wrapper').show();
        Drupal.behaviors.hamburgerSize.attach();
        if($(window).width() < 768) {
            left -= 25;
        }
        $('.modal-backdrop').remove();
        $('main').append('<div class="modal-backdrop fade"></div>');
        $('#hamburger').show();
        setTimeout(function() {
            $('.modal-backdrop').addClass('in');
            $('#hamburger').removeClass('hamburgerOut').addClass('hamburgerIn');
        }, 50);
        $('.modal-backdrop').on('click', function() {
            hideHamburger();
        });
        $('.trigger-hamburger').addClass('active').css({'left': left+'px'});
        // $('.trigger-hamburger').find('span').removeClass('icon-hamburger').addClass('icon-cross-slim');
        $('#bp-logo, .bp-usermenu').hide();
        $('body').addClass('overflow-hidden');
    }
    function hideHamburger() {
        $('#hamburger-wrapper').hide();
        $('.modal-backdrop').removeClass('in');
        $('#hamburger').removeClass('hamburgerIn').addClass('hamburgerOut');
        setTimeout(function() {
            $('#hamburger').hide();
            $('.modal-backdrop').remove();
            $('#hamburger').removeClass('hamburgerOut');
        }, 200);
        $('.trigger-hamburger').removeClass('active').css({'left': '0px'});;
        $('.trigger-hamburger').find('span').removeClass('icon-cross-slim').addClass('icon-hamburger');
        $('#bp-logo, .bp-usermenu').show();
        $('body').removeClass('overflow-hidden');
    }
    function showCartPreview() {
        if($(window).width() >= 1200 && !$('#cart-preview').hasClass('showCartPreview') && parseInt($('.cart-status .indicator').text()) > 0) {
            $('#cart-preview').addClass('showCartPreview');
            $.get('/api/cookie/cart?type=html&image_style=teaser_small', function(data) {
                if(data !== '') {
                    $('#bp-carousel-cart-preview').html(data);
                    Drupal.behaviors.slickCarousels.cartPreview();
                } else {
                    $('#bp-carousel-cart-preview').html('<p class="text-big">???? ??????? ?????</p>');
                }
            });
            setTimeout(function() {
                Drupal.behaviors.shopPages.updateQuantity();
            }, 1000);
        }
    }
    function hideCartPreview() {
        Drupal.behaviors.slickCarousels.cartPreview('unslick');
        $('#bp-carousel-cart-preview').html('');
        $('#cart-preview').removeClass('showCartPreview');
    }
    function hideRating() {
        $('#product-rating-popover').removeClass('showRating');
    }
    function recalculateRatingPreview() {
        var on = $('div.fivestar-widget div.on').length;
        var value = parseInt($('.fivestar-form-item .form-type-fivestar select').val() / 20);
        $('.rating-preview .star').each(function(index) {
            $(this).removeClass('icon-star-fill icon-star');
            if(index < value) {
                $(this).addClass('icon-star-fill');
            } else {
                $(this).addClass('icon-star');
            }
        });
    }
    function showCommentsForm() {
        $('.comment-form').show();
    }

    Drupal.behaviors.consoleMessages = {
        attach: function() {

        }
    }

    Drupal.behaviors.dropdownTrigger = {
        attach: function() {
            $('ul.mainmenu li.expanded').on('mouseover', function(e) {
                e.stopPropagation();
                headerActiveState = 'dropdown';
                showDropdown(e, this);
            });
            $('header').on('mouseleave', function(e) {
                if(headerActiveState === 'dropdown') {
                    hideDropdown(this);
                }
            });
            $('.bp-usermenu').on('mouseover', function(e) {
                hideDropdown($('ul.mainmenu'));
            });

            // Disable header popovers and dropdowns
            $('main, footer').on('click', function(e) {
                hideSearch($('.bp-usermenu .trigger-search span'));
                hideCartPreview();
                if($(e.target).parents('#product-rating-popover').length <= 0) {
                    hideRating();
                }
            });

            // On Promo and Posts pages disables dropdown
            $('ul.mainmenu li.no-dropdown.active-trail').off('mouseover');
        }
    }

    // Search Trigger
    Drupal.behaviors.searchTrigger = {
        attach: function() {
            $('.trigger-search').off('click');
            $('.trigger-search').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if(!$(e.target).hasClass('active')) {
                    showSearch();
                } else {
                    hideSearch();
                }
                hideCartPreview();
            });
            $('.trigger-close-search').off('click');
            $('.trigger-close-search').on('click', function(e) {
                e.preventDefault();
                hideSearch();
            });
        }
    }

    // Comments Trigger
    Drupal.behaviors.commentsTrigger = {
        attach: function() {
            $('.trigger-comments').off('click');
            $('.trigger-comments').on('click', function(e) {
                e.preventDefault();
                showCommentsForm();
            });

            $('.trigger-show-all-reviews').off('click');
            $('.trigger-show-all-reviews').on('click', function(e) {
                e.preventDefault();
                $('.review.hidden').removeClass('hidden');
                $(this).remove();
            });

            $('.reviews .reviews-list > a').remove();

            if($('#comments .review').length <= 6) {
                $('#comments .trigger-wrapper .trigger-show-all-reviews').remove();
                $('#comments .trigger-wrapper').text('?? ?????? ?????? ??? ?? ?????? ??????.');
            }
        }
    }

    // Cart Trigger
    Drupal.behaviors.cartTrigger = {
        attach: function() {
            $('.trigger-cart').on('mouseover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showCartPreview();
            });
            $('#cart-preview').on('mouseleave', function(e) {
                hideCartPreview();
            });
			
			$('form.commerce-add-to-cart input.form-submit').on('click', function () {
			  showCartPreview();
			  setTimeout('', 5000);
			  hideCartPreview();
	        });
        }
    }

    // Rating Trigger
    Drupal.behaviors.ratingTrigger = {
        attach: function() {
            recalculateRatingPreview();

            $('.trigger-rating').off('click');
            $('.trigger-rating').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $('#product-rating-popover').toggleClass('showRating');
            });

            $('div.fivestar-widget .star a').on('click', function() {
                recalculateRatingPreview();
            });
        }
    }

    // Expertise Trigger
    Drupal.behaviors.expertiseTrigger = {
        attach: function() {
            function insertDummyFilters() {
                if($('.filters-mobile-wrapper .filter').length === 0) {
                    var output = '<span class="filter text-small regular black"><span class="underline">????</span><a href="#" class="filter-mobile-close"><span class="icon-medium icon-cross-thick"></span></a></span>';
                    output += '<span class="filter text-small regular black"><span class="underline">????? ????</span><a href="#" class="filter-mobile-close"><span class="icon-medium icon-cross-thick"></span></a></span>';
                    output += '<span class="filter text-small regular black"><span class="underline">???????????? ????</span><a href="#" class="filter-mobile-close"><span class="icon-medium icon-cross-thick"></span></a></span>';
                    output += '<span class="filter text-small regular black"><span class="underline">??????? ????</span><a href="#" class="filter-mobile-close"><span class="icon-medium icon-cross-thick"></span></a></span>';
                    $('.filters-mobile-wrapper').prepend(output);
                }
                $('.filters-mobile-wrapper').show();
                $('.filters-mobile-wrapper .filter a').on('click', function(e) {
                    var _this = this;
                    $(this).parents('.filter').hide(250, function() {
                        $(_this).parents('.filter').remove();
                        if($('.filters-mobile-wrapper .filter').length === 0) {
                            $('.filters-mobile-wrapper').hide(250);
                        }
                    });
                });
            }

            $('.trigger-expertise').on('click', function(e) {
                e.preventDefault();
                $('#expertise-wrapper').toggle(250);
            });
            $('.button-close-expertise').on('click', function(e) {
                e.preventDefault();
                $('#expertise-wrapper').toggle(250);
            });

            $('.close-filters-modal').on('click', function(e) {
                insertDummyFilters();
            });
            $('.clear-filters-wrapper').on('click', function() {
                $('.filters-mobile-wrapper').hide(250);
            });

            // Side menu
            $('.side-menu-title a').on('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                insertDummyFilters();
                var selected = $(this).text();
                $('.side-menu-col-right .side-menu').hide();
                $('.side-menu-col-right .side-menu').each(function() {
                    if($(this).find('.side-menu-title-back .text').text().trim() === selected) {
                        $(this).show();
                    }
                });
                $('.side-menu-wrapper').stop().animate({'margin-left': '-100%'}, 250);
            });
            $('.side-menu-title-back a').on('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                $('.side-menu-col-right .side-menu').hide();
                $('.side-menu-wrapper').stop().animate({'margin-left': '0'}, 250);
            });
        }
    }

    // Hamburger Trigger
    Drupal.behaviors.hamburgerTrigger = {
        attach: function() {
            $('.trigger-hamburger').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if($(this).find('span').hasClass('icon-hamburger')) {
                    showHamburger();
                } else {
                    hideHamburger();
                }
            });
        }
    }

    // Hamburger Size
    Drupal.behaviors.hamburgerSize = {
        attach: function() {
            var mainW = $('main').width();
            var triggerW = $('.trigger-hamburger').outerWidth();
            var hamburgerW = mainW - triggerW;
            if($(window).width() < 768) {
                hamburgerW -= 15;
            }
            $('#hamburger').width(hamburgerW);
        }
    }

    // Product gallery
    Drupal.behaviors.productGallery = {
        attach: function() {
            $('.product-view').each(function() {
                var _this = this;
                $(_this).find('.product-gallery-thumb:first').addClass('active');
                $(_this).find('.product-gallery-slide:first').addClass('active');
                $(_this).find('.product-gallery-thumb').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    $(_this).find('.product-gallery-thumb').removeClass('active');
                    $(_this).find('.product-gallery-slide').removeClass('active');
                    $(_this).find('.product-gallery-thumb[data-slide="'+$(this).attr('data-slide')+'"]').addClass('active');
                    $(_this).find('.product-gallery-slide[data-slide="'+$(this).attr('data-slide')+'"]').addClass('active');
                });
                var gutter = $(_this).find('.product-gallery-gutter');
                var gallery = $(_this).find('.product-gallery');
                if(gutter.height() > gallery.height()) {
                    gallery.height(gutter.height());
                }
            });
        }
    }

    // Horizontal Tab
    Drupal.behaviors.horizontalTabs = {
        attach: function() {
            if($('.horizontal-tab').length !== 0 && $('.horizontal-tab').attr('data-tab') !== undefined) {
                $('.horizontal-tab').off('click');
                $('.horizontal-tab').on('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    $('.horizontal-tab').removeClass('active');
                    $('.horizontal-tab-content').removeClass('active');
                    $('.horizontal-tab[data-tab="'+$(this).attr('data-tab')+'"]').addClass('active');
                    $('.horizontal-tab-content[data-tab="'+$(this).attr('data-tab')+'"]').addClass('active');
                    if($(this).hasClass('trigger-slick-components')) {
                        Drupal.behaviors.slickCarousels.components();
                    }
                    if($(this).attr('data-tab') == 5) {
						Drupal.behaviors.slickCarousels.review();
                    }
                });
            }
        }
    }

    // Accordion
    Drupal.behaviors.accordion = {
        attach: function() {
            $('.accordion-title a').on('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                $(e.target).parents('.accordion').toggleClass('active');
            });
            $('.accordion-body').mCustomScrollbar();
        }
    }

    // Programs View
    Drupal.behaviors.programs = {
        attach: function() {
            $('.programs-view-product .image').on('mouseover', function() {
                $(this).siblings().removeClass('active');
                $(this).addClass('active');
            });
            $('.accordion-body').mCustomScrollbar();
        }
    }

    // Login/Register
    Drupal.behaviors.login = {
        attach: function() {
            $('.trigger-login').on('click', function(e) {
                e.preventDefault();
                var location = window.location.href;
                var name = $('#form-username').val();
                var pass = $('#form-password').val();
                var shop = $('#shop').val() ? '?shop=' + $('#shop').val() : '';
                $.post("/api/login", {name: name, pass: pass}).done(function(data) {
                    if(data === 'success') {
                        window.location.href = (location + shop);
                    }
                });
            });
            $('.modal-content .eye').on('click', function(e) {
                e.preventDefault();
                if($('.modal-content .password input').attr('type') === 'password') {
                    $('.modal-content .password .eye-closed').hide();
                    $('.modal-content .password .eye-opened').show();
                    $('.modal-content .password input').attr('type', 'text');
                } else {
                    $('.modal-content .password .eye-closed').show();
                    $('.modal-content .password .eye-opened').hide();
                    $('.modal-content .password input').attr('type', 'password');
                }
            });
        }
    }

    // Scroll brand
    Drupal.behaviors.brandViewmore = {
        attach: function() {
            $('.block-about--description a.underline').on('click', function(){
              var container_viewmore = $(this).parents('.section').find('.block-about--viewmore');
              var section = $(this).parents('.section');
              var scroll_top_depth = $(window).height()*0.65/2;
              var position_slide = $(this).parents('.section').offset().top;
              var scroll_top_position = position_slide + scroll_top_depth;

              if(!container_viewmore.hasClass('active')){
				container_viewmore.addClass('active');
                $('body').animate({
			      scrollTop: container_viewmore.offset().top - 100
		        }, 1000, function () {
			      //window.location.hash = '#news';
		        });                
              }
              else {
                container_viewmore.removeClass('active');
              }
              //$.fn.fullpage.reBuild();
              return false;
            });
            $('.block-about--viewmore .close').on('click', function(){
              var container_viewmore = $(this).parents('.block-about--viewmore');
              container_viewmore.removeClass('active');
			  $('body').animate({
			    scrollTop: container_viewmore.offset().top - 400
		      }, 1000, function () {
		      });
              //$('.scrolling-content', container_viewmore).slideUp();
              return false;
              //$.fn.fullpage.reBuild();
            });
        }
    } 

    // Map Buy
    Drupal.behaviors.mapBuy = {
        attach: function() {
            $('.trigger-google-maps').off('click');
            $('.trigger-google-maps').on('click', function(e) {
                e.preventDefault();
                $('#map-wrapper').show();

                var script_tag = document.createElement('script');
                script_tag.setAttribute("type","text/javascript");
                script_tag.setAttribute("src","https://maps.googleapis.com/maps/api/js?key=AIzaSyBgcFHz8ChNIgayolshf6_fYwbVw86HErc&callback=initMap");
                (document.getElementsByTagName("head")[0] || document.documentElement).appendChild(script_tag);

                Drupal.behaviors.mapBuy.init();

                $('html, body').stop().animate({scrollTop: $('#map-wrapper').offset().top - 60}, 500);

                $(this).remove();
            });
        },
        init: function() {
            var interval;
            var input = document.querySelector('#map-search');
            var $hints = $('.search-hints-wrapper');
            var localities;
            $.getJSON('/sites/all/themes/bp_pink/data/geodata-new.json', function(data) {
                localities = data;
            });
			$('#search-found-count').show();
			$('.block-map .form-type-city').change(function(){ 
			  
			  var city_id = $(this).val();
			  var retailer_id = $('select.form-type-retailer').val();
			  $.each( localities.cities, function( key, value ) {
				if (city_id == value['id']) {
				  showResults(city_id, retailer_id);
				}
			  });	
			});
			
			$('.block-map .form-type-retailer').change(function(){ 
			  var city_id = $('select.form-type-city').val();
			  var retailer_id = $('select.form-type-retailer').val();
			  $.each( localities.cities, function( key, value ) {
				if (city_id == value['id']) {
				  showResults(city_id, retailer_id);
				}
			  });
			  deleteMarkers();
			  showAll(retailer_id);
			});
			
            function showHints() {
                $hints.show();
            }

            function hideHints() {
                $hints.hide();
            }

            function showResults(city_id, retailer_id) {
                clearInterval(interval);
                var shops = [];
				$.each( localities.stores, function( key, store ) {
				  if (store.city_id == city_id) {
					if (retailer_id) {
					  if (retailer_id == store.retailer_id)	{
						shops.push({name: store.name, description: store.addr});  
					  }
					} else {
					  shops.push({name: store.name, description: store.addr});
					}
					
				  }
				});
                function checkCurrentPage() {
                    var index = $('.buy-search-result-page.active').index() + 1;
                    var text = String(index + ' �� ' + total_pages);
                    $('#buy-search-results-navigation .page-status').text(text);
                    if(shops.length > 0) {
                        $('#search-found-count').show();
                        $('.search-found-number').text(shops.length);
                    } else {
                        //$('#search-found-count').hide();
                    }
                    if($('.buy-search-result-page.active').prev().length > 0) {
                        $('#buy-search-results-navigation .previous').show();
                    } else {
                        $('#buy-search-results-navigation .previous').hide();
                    }
                    if($('.buy-search-result-page.active').next().length > 0) {
                        $('#buy-search-results-navigation .next').show();
                    } else {
                        $('#buy-search-results-navigation .next').hide();
                    }
                    if($('.buy-search-result-page').length < 2) {
                        $('#buy-search-results-navigation .page-status').hide();
                    } else {
                        $('#buy-search-results-navigation .page-status').show();
                    }
                }
                var per_page = 10;
                var total_count = shops.length;
                var total_pages = Math.ceil(shops.length / per_page);
                var count_pages = 1;
                var navigation = '<a href="#" class="previous control pink">&lsaquo; ����������</a><span class="page-status">1 �� 30</span><a href="#" class="next pink control">��������� &rsaquo;</a>';
                var output = '';
                for(var p=0; p<total_pages; p++) {
                    output += '<div class="buy-search-result-page" data-page="'+(p+1)+'">';
                    output += '<div class="row">';
                    for(var j=(p*per_page); j<per_page+(p*per_page); j++) {
                        if(typeof shops[j] === 'object') {
                            output += '<div class="buy-search-result-item col-12 col-lg-4 col-md-6">';
                            output += '<p class="text">'+shops[j].description+'</p>';
                            output += '<div class="title-retailer pink">'+shops[j].name+'</div>';
                            output += '</div>';
                        }
                    }
                    output += '</div>';
                    output += '</div>';
                }
                setTimeout(function() {
                    $('#buy-search-results').html(output);
                    $('#buy-search-results-nav').html('<div id="buy-search-results-navigation">'+navigation+'</div>');
                    $('.buy-search-result-page:first').addClass('active');
                    $('#buy-search-results-navigation .control').unbind('click');
                    $('#buy-search-results-navigation .previous').bind('click', function(e) {
                        e.preventDefault();
                        if($('.buy-search-result-page.active').prev().length > 0) {
                            $('.buy-search-result-page.active').removeClass('active').prev().addClass('active');
                        }
                    });
                    $('#buy-search-results-navigation .next').bind('click', function(e) {
                        e.preventDefault();
                        if($('.buy-search-result-page.active').next().length > 0) {
                            $('.buy-search-result-page.active').removeClass('active').next().addClass('active');
                        }
                    });
                    interval = setInterval(function() {
                        checkCurrentPage();
                    }, 250);
                    $('#preloader').hide();
                    $('#search-found-count').css('opacity', 1);
                }, 2000);
            }

            function loadHints(e) {
                if(e.target.value.length >= 3) {
                    var value = e.target.value;
                    var results = [];
                    $hints.find('a').unbind('click');
                    $hints.find('ul').html('');
                    for(var name in localities) {
                        if(name.toLowerCase().includes(value.toLowerCase())) {
                            results.push('<li class="search-hint"><a href="#" data-lat="'+localities[name].pos.lat+'" data-lng="'+localities[name].pos.lng+'">'+name+'</a></li>');
                        }
                    }
                    results.sort(function(a, b) {
                        return a.length - b.length;
                    });
                    if($hints.length > 0) {
                        for(var i=0; i<results.length; i++) {
                            showHints();
                            $hints.find('ul').append(results[i]);
                            $hints.mCustomScrollbar();
                        }

                        // Binds click event
                        $hints.find('a').bind('click', function(e) {
                            var lat = parseFloat($(this).attr('data-lat'));
                            var lng = parseFloat($(this).attr('data-lng'));
                            e.preventDefault();
                            map.setCenter({lat: lat, lng: lng});
                            map.setZoom(10);
                            hideHints();
                            $('#preloader').show();
                            //$('#search-found-count').css('opacity', .5);
                            //showResults($(this).text().trim());
                            input.value = $(this).text().trim();
                        });
                    } else {
                        hideHints();
                    }
                } else {
                    hideHints();
                }
            }

            function getUsersLoc() {
                $.get("http://ipinfo.io", function(response) {
                    var loc = response.loc.split(',');
                    var lat = parseFloat(loc[0]);
                    var lng = parseFloat(loc[1]);
                    map.setCenter({lat: lat, lng: lng});
                    map.setZoom(10);
                }, "jsonp");
            }

            input.removeEventListener('keyup', function() {});

            input.addEventListener('keyup', loadHints);

            setTimeout(getUsersLoc, 1000);
        }
    }
    
    // Init map on page Where Buy
    Drupal.behaviors.whereBuy = {
      attach: function() {
        if($('.block-map').length > 0){
          var script_tag = document.createElement('script');
          script_tag.setAttribute("type","text/javascript");
          script_tag.setAttribute("src","https://maps.googleapis.com/maps/api/js?key=AIzaSyBgcFHz8ChNIgayolshf6_fYwbVw86HErc&callback=initMap");
          (document.getElementsByTagName("head")[0] || document.documentElement).appendChild(script_tag);   
          
          Drupal.behaviors.mapBuy.init();
          
          // Reference to the DIV that wraps the bottom of infowindow
          $('.block-map').on("click", function(){
            var iwOuter = $('.gm-style-iw');
            /* Since this div is in a position prior to .gm-div style-iw.
             * We use jQuery and create a iwBackground variable,
             * and took advantage of the existing reference .gm-style-iw for the previous div with .prev().
            */
            var iwBackground = iwOuter.prev();
  
            // Removes background corner
            iwBackground.css({'display' : 'none'});
            
            // Removes background shadow DIV
            iwBackground.children(':nth-child(2)').css({'display' : 'none'});

            // Removes white background DIV
            iwBackground.children(':nth-child(4)').css({'display' : 'none'});

            // Moves the infowindow 115px to the right.
            iwOuter.parent().parent().css({left: '115px'});

            // Moves the shadow of the arrow 76px to the left margin.
            iwBackground.children(':nth-child(1)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

            // Moves the arrow 76px to the left margin.
            iwBackground.children(':nth-child(3)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

            // Changes the desired tail shadow color.
            iwBackground.children(':nth-child(3)').find('div').children().css({'box-shadow': 'rgba(0, 0, 0, 0.35) 0px 3px 7px', 'z-index' : '1'});

            // Reference to the div that groups the close button elements.
            var iwCloseBtn = iwOuter.next();

            // Apply the desired effect to the close button
            iwCloseBtn.addClass('icon-cross-slim').css({opacity: '1', right: '57px', top: '22px', width: '20px', height: '20px', 'font-size': '18px', 'color': '#712b90'}); 
            $('img', iwCloseBtn).css({'display' : 'none'});
            
          });
          // load info about shops
          var regions = $('.block-map .form-type-region');
          var city = $('.block-map .form-type-city');
          var retailer = $('.block-map .form-type-retailer');
          var localities;
          $.getJSON('http://nevid.ikonan.ru/sites/all/themes/bp_pink/data/geodata-new.json', function(data) {
              localities = data;
          

          regions.chosen({disable_search: true});           
          city.chosen({disable_search: true});           
          retailer.chosen({disable_search: true});       
          
          regions.change(function(){
            var region_id = $(this).val();
            refreshCitiesOptions(region_id, localities);
          });
          
          city.change(function(){
            var city_id = $(this).val();
            if (city_id) {
              $.each( localities.cities, function( key, value ) {
                if (city_id == value['id']) {
                  map.setCenter({lat: value['lat'], lng: value['lon']});
                  map.setZoom(10);
                }
              });		  
            }
          });
		  
          function refreshCitiesOptions(region_id, localities) {
          var cities_list = [];
          $.each( localities.cities, function( key, value ) {
            if (value['region_id'] == region_id) {
            cities_list.push(value);
            }
            
            
          });
          
          $('select.form-type-city').html('');
          $('select.form-type-city').append( '<option value="" selected="selected">������� ��� �����</option>' );
          $.each( cities_list, function( key, city ) {
            $('select.form-type-city').append( '<option value="' + city.id + '" >' + city.name + '</option>' );
            $('select.form-type-city').trigger("chosen:updated");
          });
          }
          
          });
        }        
      }
    }    

    

    // Resize Listener
    $(window).bind('resize', function(){
        Drupal.behaviors.hamburgerSize.attach();
    });

    // Orientation Change Listener
    window.addEventListener("orientationchange", function() {
        Drupal.behaviors.hamburgerSize.attach();
    }, false);

}(jQuery));
(function($) {

     Drupal.behaviors.shopPages = {
        attach: function() {

            // Compare Page
            if($('.compare-table').length > 0) {
                if($('#bp-carousel-compare-content .product-item').length > 0) {
                    $('#add-to-compare').hide();
                    $('#compare-table-wrapper').show();
                    Drupal.behaviors.slickCarousels.compare();
                    Drupal.behaviors.shopPages.equalizeCellHeights();
                    if($('.bp-carousel-compare-thead-wrapper .trigger-show-main-propeties').hasClass('active')){
                        $('.compare-table .compare-cell.secondary-properties').addClass('hidden');
                    }
                } else {
                    $('#compare-table-wrapper').hide();
                    $('#add-to-compare').show();
                }
            }

            // Cart Page
            if($('.cart-table').length > 0) {
                // Checkout form
                var firstname = '',
                    lastname = '',
                    cell = '',

                    delivery = '',
                    deliveryPrice = 0,

                    payment = '',

                    city = $('select[name="personal_data_city"]').val().trim(),
                    street = '',
                    building = '',
                    flat = '',
                    entrance = '',
                    code = '',
                    floor = '',

                    day = $('select[name="date_day"]').val().trim(),
                    time = $('select[name="date_time"]').val().trim();

                function checkoutActions() {

                    // Trigger Checkout
                    $('#shop').on('change', function() {
                        if($(this).val() !== '') {
                            $('.cart-subtotal, .cart-checkout-prompt').hide();
                            $('.trigger-checkout').parent().show();
                            $('.trigger-modal').parent().show();
                        }
                    });

                    // See if user has logged in and selected the shop
                    var query = window.location.search;
                    var shopID = query.substr(query.search('=')+1, query.length);
                    if(shopID.length > 0) {
                        $('#shop').val(shopID).change();
                    }

                    // Trigger Checkout
                    $('.trigger-checkout').on('click', function(e) {
                        e.preventDefault();
                        $('.checkout-wrapper').show();
                        $('.trigger-checkout').parent().hide();
                        $('.trigger-checkout-delivery-method').parent().show();
                    });

                    // Trigger Checkout Delivery Method
                    $('.trigger-checkout-delivery-method').on('click', function(e) {
                        e.preventDefault();
                        if($('input[name="delivery_method"]:checked').length > 0) {
                            $('.trigger-checkout-delivery-method').parent().hide();
                            $('.checkout-payment-method').show();
                            $('.trigger-checkout-payment-method').parent().show();
                        }
                    });

                    // Trigger Checkout Payment Method
                    $('.trigger-checkout-payment-method').on('click', function(e) {
                        e.preventDefault();
                        if($('input[name="payment_method"]:checked').length > 0) {
                            $('.trigger-checkout-payment-method').parent().hide();
                            $('.checkout-personal-data').show();
                            $('.trigger-checkout-personal-data').parent().show();
                        }
                    });

                    // Trigger Checkout Personal Data
                    $('.trigger-checkout-personal-data').on('click', function(e) {
                        e.preventDefault();
                        if(
                            $('input[name="personal_data_firstname"]').val() !== '' &&
                            $('input[name="personal_data_lastname"]').val() !== '' &&
                            $('input[name="personal_data_cell"]').val() !== '' &&
                            $('input[name="personal_data_street"]').val() !== '' &&
                            $('input[name="personal_data_building"]').val() !== ''
                        ) {
                            $('.trigger-checkout-personal-data').parent().hide();
                            $('.checkout-date').show();
                            $('.trigger-checkout-date').parent().show();
                        }
                    });

                    // Trigger Checkout Date
                    $('.trigger-checkout-date').on('click', function(e) {
                        e.preventDefault();
                        $('.trigger-checkout-date').parent().hide();
                        $('.checkout-confirmation').show();
                        $('.trigger-checkout-confirmation').parent().show();
                    });

                    // Trigger Checkout Confirmation
                    $('.trigger-checkout-confirmation').on('click', function(e) {
                        
                    });
                }

                function getSubTotal() {
                    var sum = 0;
                    $('.cart-table-body tr').each(function() {
                        var qty = parseInt($(this).find('.quantity').val());
                        if(qty) {
                            var price = parseFloat($(this).find('.price-value').text().trim().replace(',', '.').replace(' ', ''));
                            sum += price * qty;
                        }
                    });
                    return sum;
                }

                function updateTotal() {
                    var total = getSubTotal() + deliveryPrice;
                    $('.cart-subtotal-sum').text(getSubTotal() + ',00');
                    $('.cart-total-sum').html('<strong>'+total + '</strong>,00');
                    $('.cart-delivery-sum').text(deliveryPrice + ',00');
                }

                function receiver() {
                    if(firstname.length > 0 && lastname.length > 0 && cell.length > 0) {
                        return firstname + ' ' + lastname + '<br>' + cell;
                    }
                    return '';
                }

                function deliveryMethod() {
                    if(delivery.length > 0) {
                        return delivery;
                    }
                    return '';
                }

                function paymentMethod() {
                    if(payment.length > 0) {
                        return payment;
                    }
                    return '';
                }

                function deliveryDate() {
                    if(day.length > 0 && time.length > 0) {
                        return '???????? ' + day + ', ' + time;
                    }
                    return '';
                }

                function address() {
                    var output = '';

                    output += city.length > 0 ? city : '';
                    output += street.length > 0 ? ', ' + street : '';
                    output += building.length > 0 ? ', ??? ' + building : '';
                    output += flat.length > 0 ? ', ??. ' + flat : '';
                    output += entrance.length > 0 ? ', ??????? ' + entrance : '';
                    output += code.length > 0 ? ', ??? ???????? ' + code : '';
                    output += floor.length > 0 ? ', ???? ' + floor : '';

                    return output;
                }

                checkoutActions();

                $('input[name="delivery_method"]').on('change', function() {
                    delivery = $(this).val().trim();
                    deliveryPrice = parseFloat($('.'+$(this).attr('id')).text().replace(',', '.').replace(' ', ''));
                });
                $('input[name="payment_method"]').on('change', function() {
                    payment = $(this).val().trim();
                });
                $('input[name="personal_data_firstname"]').on('change', function() {
                    firstname = $(this).val().trim();
                });
                $('input[name="personal_data_lastname"]').on('change', function() {
                    lastname = $(this).val().trim();
                });
                $('input[name="personal_data_cell"]').on('change', function() {
                    cell = $(this).val().trim();
                });
                $('select[name="date_day"]').on('change', function() {
                    day = $(this).val().trim();
                });
                $('select[name="date_time"]').on('change', function() {
                    time = $(this).val().trim();
                });
                $('select[name="personal_data_city"]').on('change', function() {
                    city = $(this).val().trim();
                });
                $('input[name="personal_data_street"]').on('change', function() {
                    street = $(this).val().trim();
                });
                $('input[name="personal_data_building"]').on('change', function() {
                    building = $(this).val().trim();
                });
                $('input[name="personal_data_flat"]').on('change', function() {
                    flat = $(this).val().trim();
                });
                $('input[name="personal_data_entrance"]').on('change', function() {
                    entrance = $(this).val().trim();
                });
                $('input[name="personal_data_code"]').on('change', function() {
                    code = $(this).val().trim();
                });
                $('input[name="personal_data_floor"]').on('change', function() {
                    floor = $(this).val().trim();
                });

                var checkoutInterval = setInterval(function() {
                    $('.confirmation-personal-data p').html(receiver());
                    $('.confirmation-delivery-method p').html(deliveryMethod());
                    $('.confirmation-payment-method p').html(paymentMethod());
                    $('.confirmation-date p').html(deliveryDate());
                    $('.confirmation-address p').html(address());
                    updateTotal();
                    Drupal.behaviors.shopPages.updateQuantity();
                }, 1000);
            }
            if($('.cart-total').length === 0) {
                $('.trigger-clear-cart').off('click');
                $('.trigger-clear-cart').on('click', function(e) {
                    e.preventDefault();
                });
            }
            if($('.cart-table').length > 0) {
                $('.trigger-trash').off('click');
                $('.trigger-trash').on('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    Drupal.behaviors.shopCart.removeProduct(this);
                    setTimeout(function() {
                        if(parseInt($('.cart-status .indicator').text().trim()) === 0) {
                            window.location = '/cart';
                        }
                    }, 1000);
                });
            }
        },
        equalizeCellHeights: function() {
            var rows = {};

            // Populate the rows object with maximum height of cells in a row
            $('.compare-table').each(function() {
                $(this).find('.compare-cell').each(function(cellIndex) {
                    if(typeof rows[cellIndex] === 'undefined') {
                        rows[cellIndex] = 0;
                    }
                    if($(this).outerHeight() > rows[cellIndex]) {
                        rows[cellIndex] = $(this).outerHeight();
                    }
                });
            });

            // Resize the cells according to maximum height to make them even
            $('.compare-table').each(function() {
                for(var index in rows) {
                    $(this).find('.compare-cell').eq(index).css('height', rows[index] + 25);
                }
            });
        },
        updateQuantity: function() {
            var text = '';
            var qty = parseInt($('.cart-status .indicator').text().trim());

            if(qty === 1) {
                text = '1 продукт';
            } else if(qty > 1 && qty < 5) {
                text = qty + ' продукта';
            } else {
                text = qty + ' продуктов';
            }

            $('.cart-subtotal-products').text(text); 
        }
    } 

    /**
     * Catalogue Page
     */
    Drupal.behaviors.shopCataloguePage = {
        attach: function() {
            function build_query() {
                query = {"type": "html", "image_style": "teaser_normal"};
                $('.catalogue-forms .accordion').each(function() {
                    var $form = $(this);
                    var trigger = $form.find('.trigger-catalogue-form');
                    var field = $(trigger).attr('data-field');
                    var type = $(trigger).attr('type');

                    switch(type) {
                        case 'radio':
                            var value = $('.catalogue-forms input[name="'+field+'"]:checked').val();
                            if($('.catalogue-forms input[name="'+field+'"]:checked').length > 0) {
                                query[field] = value;
                            }
                            break;

                        case 'checkbox':
                            var value = '';
                            $('.catalogue-forms input[data-field="'+field+'"]').each(function() {
                                if($(this).is(':checked')) {
                                    if(value.length > 0) {
                                        value += ',';
                                    }
                                    value += $(this).val();
                                }
                            });
                            if($('.catalogue-forms input[data-field="'+field+'"]:checked').length > 0) {
                                query[field] = value;
                            }
                            break;

                        default:
                            break;
                    }
                });
                return query;
            }

            function init_query() {
                var params = build_query();
                var url = '/api/get/products/';
                $('.catalogue-products .ajax-loader').show();
                $('#catalogue-products-view').css('opacity', .25);

                $.get(url, params, function(data) {
                    $('.catalogue-products .ajax-loader').hide();
                    $('#catalogue-products-view').css('opacity', 1).html(data);
                    
                }).done(function(data) {
                  Drupal.behaviors.slickCarousels.productsView();
                });
            }
            if($('.catalogue-forms').length > 0) {
                $('.trigger-catalogue-form').on('click', function(e) {
                    init_query();
					var data = {};
					var has_one_checked = false;
					$('.accordion-wrapper.catalogue-forms input').each(function() {
					  if (!data[$(this).attr('data-field')]) {
					    data[$(this).attr('data-field')] = {};
					  }
					  var ind = $(this).attr('data-tid');
					  if ($(this).is(':checked')) {
						ind += '_checked'; 
						has_one_checked = true;
					  }
					  data[$(this).attr('data-field')][ind] = $(this).attr('data-tid');					  
					});
					//console.log(data);
					$('.accordion-wrapper.catalogue-forms input').each(function() {
						if ($(this).attr('disabled') == 'disabled') {
						  $(this).attr('disabled', false);
						}
					  });
					if (has_one_checked) {
					
					$.post('/api/filters_reset', data, function(response) {
		              //response = $.parseJSON(response);
					  
					  for (var field_name in response) {
						for (var key in response[field_name]) {
						  if (key.split('disabled').length == 2) {
							$('.accordion-wrapper.catalogue-forms input[data-field="' + field_name + '"][data-tid="' + response[field_name][key] + '"]').attr('disabled', 'disabled');  
						  }	
						}
					  }
					  
                    });
					}
					
                });
                init_query();
            }
        }
    }

    /**
     * General Methods
     */
    Drupal.behaviors.shopProductsByIds = {
        get: function(ids, func) {
            $.getJSON('/api/get/products/', {"ids": ids, "type": "json"}, function(data) {
                func(data);
            });
        }
    }
	
    Drupal.behaviors.videoClick = {
        attach: function() {
          $('.video-wrapper .video-wrapper-link').on('click', function(e) {
          $(this).find('.arrow-video').fadeOut();
          $(this).find('.video-title').fadeOut();
          $(this).find('img').fadeOut();
          $(this).find('iframe').css('visibility', 'visible');
          $(this).find('iframe').css('height', '272px');
          $(this).css('height', '292px');
          $(this).find('iframe')[0].src += "?autoplay=1";
          var data = {nid: $(this).attr('class').split('nid-')[1]};
          $.post('/video_list/add_node_view', data, function(response) { });
          
          e.preventDefault();
        });
      }
    }
    
    Drupal.behaviors.videoTeaserClick = {
        attach: function() {
          $('.bp-card-video-content .arrow-video').on('click', function(e) {
            $(this).parents('.bp-card-video-content').addClass('show-video');
            $(this).parents('.bp-card-video-content').find('.arrow-video').fadeOut();
            $(this).parents('.bp-card-video-content').find('.video-title').fadeOut();
            $(this).parents('.bp-card-video-content').find('img').fadeOut();

            $(this).parents('.bp-card-video-content').find('iframe').css('visibility', 'visible');
            //$(this).find('iframe').css('height', '272px');
            //$(this).css('height', '292px');
            $(this).parents('.bp-card-video-content').find('iframe')[0].src += "?autoplay=1";
            
            //var data = {nid: $(this).attr('class').split('nid-')[1]};
            //$.post('/video_list/add_node_view', data, function(response) { });
          
            e.preventDefault();
          });
        }
    }
   

}(jQuery));